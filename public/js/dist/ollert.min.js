var AnalysisController=function(){var a=function(a,b,c,d,f,h){g(a,b,c,d,f,h),e(a,h)},b=function(a){return $("#"+a).val()},c=function(){return b("starting-list")},d=function(){return b("ending-list")},e=function(a,b){var e=c(),f=d(),g=$("#show-archived").get(0).checked;WipChartBuilder.build(a,b,g),StatsBuilder.build(a,b,g),LabelCountChartBuilder.build(a,b,g),ProgressChartBuilder.build(a,b,e,f,g),ListChangesChartBuilder.build(a,b,e,f,g)},f=function(a,b){var f=c(),g=d(),h=$("#show-archived").get(0).checked;$("#configure-board-modal").modal("hide"),$.ajax({url:"/boards/"+a,type:"put",data:{startingList:f,endingList:g,archived:h}}),e(a,b)},g=function(a,b,c,d,e,g){h($("#starting-list"),b,c),h($("#ending-list"),b,d),$("#show-archived").get(0).checked=e,$("#submit-board-lists").on("click",function(){f(a,g)})},h=function(a,b,c){for(var d=0;d<b.length;d++)a.append("<option value='"+b[d].id+"'>"+b[d].name+"</option>");a.val(c)};return{init:a}}(),BurnUpDownChartBuilder=function(){var a=function(a,b,c){b.highcharts("StockChart",{chart:{type:"area",zoomType:"x"},rangeSelector:{buttons:[{type:"week",count:1,text:"1w"},{type:"week",count:2,text:"2w"},{type:"month",count:1,text:"1m"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}],selected:2},title:{text:c},xAxis:{minRange:864e5,tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{floor:0,title:{text:"Cards"},labels:{}},tooltip:{shared:!0,valueSuffix:" cards"},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}}},credits:{enabled:!1},series:a})},b=function(b){$("#burn-up-spinner").hide();var c=$("#burn-up-container");c.height(c.height()-10);var d=[];d.push({name:"To Do",data:b.cfddata[0].data}),d.push({name:"Completed",data:b.cfddata[1].data}),a(d,c,"Burn Up")},c=function(b){$("#burn-down-spinner").hide();var c=$("#burn-down-container");c.height(c.height()-10);var d=[];d.push({name:"To Do",data:b.cfddata[0].data}),a(d,c,"Burn Down")};return{buildBurnUp:b,buildBurnDown:c}}(),CfdChartBuilder=function(){var a=function(a){$("#cfd-container").highcharts("StockChart",{chart:{type:"area",zoomType:"x"},rangeSelector:{buttons:[{type:"week",count:1,text:"1w"},{type:"week",count:2,text:"2w"},{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}],selected:2},title:{text:"Cumulative Flow Diagram"},subtitle:{text:"CFD"},xAxis:{minRange:864e5,tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{floor:0,title:{text:"Cards"},labels:{}},tooltip:{shared:!0,valueSuffix:" cards"},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}}},credits:{enabled:!1},series:a.cfddata})},b=function(b){$("#cfd-spinner").hide();var c=$("#cfd-container");c.height(c.height()-10),a(b)};return{build:b}}(),FlashMessage=function(){function a(a){c("alert-danger",a)}function b(a){c("alert-success",a)}function c(a,b){$("#flash").remove(),$("#mainContent").prepend("<div id='flash' class='row alert "+a+"''><div class='container'>"+b+"</div></div>")}return{error:a,success:b}}(),LabelCountChartBuilder=function(){var a=function(a){$("#label-count-container").highcharts({chart:{type:"bar"},title:{text:"Card count per label"},subtitle:{text:"cards can have multiple labels"},xAxis:{categories:a.labels,title:{text:null}},yAxis:{min:0,title:{text:"Cards",align:"high"},labels:{overflow:"justify"}},tooltip:{pointFormat:"Cards in list: <strong>{point.y} Cards</strong>"},plotOptions:{bar:{dataLabels:{enabled:!0},colorByPoint:!0,colors:a.colors}},credits:{enabled:!1},series:[{name:"Cards in List",showInLegend:!1,data:a.counts}]})},b=function(b,c,d){var e=$("#label-count-container");e.height(e.height()-10),$.ajax({url:"/api/v1/labels/"+b,headers:{Authorization:c},data:{show_archived:d},success:function(b){$("#label-count-spinner").hide(),a(jQuery.parseJSON(b))},error:function(a){$("#label-count-spinner").hide(),e.text(a.responseText)}})};return{build:b}}(),ListChangesChartBuilder=function(){var a=function(a){$("#list-changes-container").highcharts({chart:{type:"column"},title:{text:"Time Spent in Lists"},xAxis:{categories:a.categories,title:{text:null}},yAxis:{min:0,title:{text:"Days"},labels:{overflow:"justify"}},legend:{enabled:!0},tooltip:{pointFormat:"Average {series.name}: <strong>{point.y:,.2f}</strong>",format:"{point.y:,.2f}"},plotOptions:{bar:{dataLabels:{enabled:!0,format:"{point.y:,.2f}"}}},credits:{enabled:!1},series:a.data})},b=function(b,c,d,e,f){var g=$("#list-changes-container");g.height(g.height()-10),$.ajax({url:"/api/v1/listchanges/"+b,headers:{Authorization:c},data:{show_archived:f},success:function(b){$("#list-changes-spinner").hide();var c=new Ollert.TimeTracker(jQuery.parseJSON(b),d,e).average();a({categories:c.lists,data:[{name:"Total Days",data:c.total_days},{name:"Business Days",data:c.business_days}]})},error:function(a){$("#list-changes-spinner").hide(),g.text(a.responseText)}})};return{build:b}}(),LoadingIndicator=function(a){a.find(".loading-indicator").remove(),a.append("<div class='loading-indicator'/>"),this.indicator=a.find(".loading-indicator")};LoadingIndicator.prototype=function(){var a=function(a){this.indicator.html(a),this.indicator.addClass("loading-error")},b=function(a){this.indicator.html(a),this.indicator.addClass("loading-success")},c=function(a){this.indicator.append("<img src='../img/spinner.gif'/>"),this.indicator.append(a)};return{error:a,success:b,show:c}}();var Ollert=function(){var a=function(){c(),$("body").toggleClass("has-drawer");var a=new Hammer($("body")[0]);a.on("swipeleft",function(a){$("#config-drawer").hasClass("open")&&$(".drawer-controls a").click()}),a.on("swiperight",function(a){$("#config-drawer").hasClass("open")||$(".drawer-controls a").click()}),b()},b=function(){window.localStorage&&"true"!=window.localStorage.getItem("hasAcknowledgedDrawer")&&setTimeout(function(){$(".drawer-controls a").addClass("shake")},2500),$(".drawer-controls a").on("click",function(){window.localStorage.setItem("hasAcknowledgedDrawer",!0)})},c=function(){d()},d=function(){e("Loading boards, please wait..."),$.ajax({url:"/boards.json",method:"get",headers:{Accept:"application/json"},dataType:"json",success:f,error:function(a){e(a.responseJSON.error)}})},e=function(a){$("#config-drawer-board-list").empty(),a&&$("#config-drawer-board-list").append($("<span>"+a+"</span>"))},f=function(a){e();var b,c,d=a.data;for(var f in d){c=d[f],organizationBoards=$("<ul/>");for(var g=0;g<c.length;++g)b=c[g],item=$("<li/>",{role:"presentation"}),item.append($('<a href="/boards/'+b.id+'">'+b.name+"</a>")),organizationBoards.append(item);var h=$('<li role="presentation"><b>'+f+"</b></li>").append(organizationBoards);$("#config-drawer-board-list").append(h)}},g=function(a){$(".settings-link > img").attr("src","http://www.gravatar.com/avatar/"+a+"?s=40")};return{initDrawer:a,refreshDrawer:c,loadAvatar:g}}();$.fn.enable=function(){this.attr("disabled",!1)},$.fn.disable=function(){this.attr("disabled",!0)};var ProgressChartBuilder=function(){var a=function(a){var b=jQuery.parseJSON(a);CfdChartBuilder.build(b.cfd),BurnUpDownChartBuilder.buildBurnUp(b.burnup),BurnUpDownChartBuilder.buildBurnDown(b.burnup)},b=function(){$("#burn-up-spinner").show(),$("#burn-up-container").empty(),$("#burn-down-spinner").show(),$("#burn-down-container").empty(),$("#cfd-spinner").show(),$("#cfd-container").empty()},c=function(c,d,e,f,g){b(),$.ajax({url:"/api/v1/progress/"+c,data:{starting_list:e,ending_list:f,show_archived:g},headers:{Authorization:d},success:a,error:function(a){$("#cfd-spinner").hide(),$("#burn-up-spinner").hide(),$("#burn-down-spinner").hide(),$("#cfd-container").text(a.responseText),$("#burn-up-container").text(a.responseText),$("#burn-down-container").text(a.responseText)}})};return{build:c}}(),SettingsController=function(){function a(){$("#trello-connect").on("click",c),$("#update-email").on("submit",b),$("#email-info").popover(),$("#delete-account").on("submit",d)}function b(a){a.preventDefault();var b=new LoadingIndicator($("#email-status"));b.show("Saving..."),$("#update-email input").disable(),$.ajax({url:"/settings/email",data:{email:$("#email").val()},method:"PUT",success:function(a){b.success("Your new email is <b>"+a+"</b>. Use this to log in.")},error:function(a){b.error(a.responseText+" ("+a.status+": "+a.statusText+")")},complete:function(){$("#update-email input").enable()}})}function c(){TrelloController.authorize(e)}function d(a){a.preventDefault();var b=new LoadingIndicator($("#delete-account-status"));b.show("Deleting..."),$("#delete-account input").disable(),$.ajax({url:"/settings/delete",data:{iamsure:$("#i-am-sure")[0].checked,_method:"DELETE"},method:"POST",success:function(){b.success("Account deleted. Redirecting..."),self.location="/"},error:function(a){b.error(a.responseText+" ("+a.status+": "+a.statusText+")")},complete:function(){$("#delete-account input").enable()}})}var e=function(){var a=new LoadingIndicator($("#trello-connect-status span"));a.show("Saving..."),$("#trello-connect").disable(),$.ajax({url:"/settings/trello/connect",data:{token:Trello.token()},method:"PUT",success:function(b){b=jQuery.parseJSON(b),a.success("Currently connected to Trello as <strong>"+b.username+"</strong>"),Ollert.loadAvatar(b.gravatar_hash)},error:function(b){a.error(b.responseText+" ("+b.status+": "+b.statusText+")")},complete:function(){$("#trello-connect").enable(),Ollert.refreshDrawer()}})};return{init:a}}(),StatsBuilder=function(){var a=function(a){$("#board-members-count").text(a.board_members_count),$("#card-count").text(a.card_count),$("#avg-members-per-card").text(a.avg_members_per_card),$("#avg-cards-per-member").text(a.avg_cards_per_member),$("#list-with-most-cards-name").text(a.list_with_most_cards_name),$("#list-with-most-cards-name").attr("title",a.list_with_most_cards_name),$("#list-with-most-cards-count").text(a.list_with_most_cards_count),$("#list-with-least-cards-name").text(a.list_with_least_cards_name),$("#list-with-least-cards-name").attr("title",a.list_with_least_cards_name),$("#list-with-least-cards-count").text(a.list_with_least_cards_count),$("#oldest-card-name").text(a.oldest_card_name),$("#oldest-card-name").attr("title",a.oldest_card_name),$("#oldest-card-age").text(a.oldest_card_age),$("#newest-card-name").text(a.newest_card_name),$("#newest-card-name").attr("title",a.newest_card_name),$("#newest-card-age").text(a.newest_card_age)},b=function(b,c,d){$.ajax({url:"/api/v1/stats/"+b,data:{show_archived:d},headers:{Authorization:c},success:function(b){$(".stats-spinner").hide(),a(jQuery.parseJSON(b))},error:function(a){$(".stats-spinner").hide(),$(".stat-value").css({"font-size":"2em"}),$(".stat-value").text(a.responseText)}})};return{build:b}}();!function(a){"use strict";function b(a,b,c){var d=function(){var d=a.lists,e=_.findWhere(d,{id:b}),f=_.findWhere(d,{id:c}),g=Math.max(d.indexOf(e),0),h=f?d.indexOf(f):d.length;return d.slice(g,h)},f=a.times,h=function(a){var b=_.find(d(),function(b){return b.id===a});return b?b.name:null};this.average=function(){var a,b=_.pairs(g(_.pluck(f,"times")));return a=_.reduce(b,function(a,b){var c=b[0],d=b[1],e=h(c);return _.isString(e)&&(a.lists.push(e),a.total_days.push(d.average("total_days")),a.business_days.push(d.average("business_days"))),a},{lists:[],total_days:[],business_days:[]}),e(a,_.pluck(d(),"name"))}}var c=function(a){return _.property(a)(this)/this.list_count},d=function(){return{business_days:0,total_days:0,list_count:0,average:c}},e=function(a,b){if(_.isEmpty(a.lists))return a;var c=_.zip(a.lists,a.total_days,a.business_days),d=_.map(b,function(a){var b=function(b){return _.first(b)===a};return _.find(c,b)}),e=_.compact(d);return _.object(["lists","total_days","business_days"],_.zip.apply(_,e))},f=function(a,b){var c=function(b){return a[b]=a[b]||d()},e=c(_.first(b)),f=_.last(b);e.total_days+=f.total_days,e.business_days+=f.business_days,e.list_count++},g=function(a){return _.reduce(a,function(a,b){return _.each(_.pairs(b),_.partial(f,a)),a},{})};a.TimeTracker=b}(Ollert);var TrelloController=function(){var a=function(a){Trello.deauthorize(),Trello.clearReady(),Trello.authorize({name:"Ollert",type:"popup",interactive:!0,expiration:"never",persist:!1,success:a||b,scope:{read:!0,write:!0,account:!0}})},b=function(a){$(".connect-btn").text("Connecting..."),$.ajax({url:"/trello/connect",method:"put",data:{token:Trello.token()},success:function(){$(".connect-btn").text("Connection successful. Redirecting..."),self.location="/boards"},error:function(a,b,c){a.responseText&&(FlashMessage.error(a.responseText),$(".connect-btn").text("Connection failed. Try again."))}})};return{authorize:a}}(),WipChartBuilder=function(){var a=function(a){$("#wip-container").highcharts({chart:{type:"bar"},title:{text:"Work In Progress"},subtitle:{text:"WIP"},xAxis:{categories:a.categories,title:{text:null}},yAxis:{min:0,title:{text:"Cards",align:"high"},labels:{overflow:"justify"}},tooltip:{pointFormat:"Cards in list: <strong>{point.y} Cards</strong>"},plotOptions:{bar:{dataLabels:{enabled:!0}}},credits:{enabled:!1},series:a.data})},b=function(b,c,d){var e=$("#wip-container");e.height(e.height()-10),$.ajax({url:"/api/v1/wip/"+b,headers:{Authorization:c},data:{show_archived:d},success:function(b){$("#wip-spinner").hide();var c=jQuery.parseJSON(b);a({categories:c.wipcategories,data:[{name:"Cards in List",showInLegend:!1,data:c.wipdata}]})},error:function(a){$("#wip-spinner").hide(),e.text(a.responseText)}})};return{build:b}}();
//# sourceMappingURL=ollert.min.js.map